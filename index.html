<script>
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ displayDrugs ...

  function displayDrugs(list) {
    const container = document.getElementById('results');
    if (list.length === 0) {
      container.innerHTML = '<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
      document.getElementById('compareBtn').disabled = true;
      return;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ data-drug
    container.innerHTML = list.map((drug, idx) => 
      `<div class="drug">
        <label>
          <input type="checkbox" data-drug='${JSON.stringify(drug).replace(/'/g, "&#39;")}'>
          <i class="fas fa-capsules"></i>
          <div>
            <strong>${drug.trade_name || '‚Äî'}</strong><br>
            <small>–ú–ù–ù: ${drug.mnn || '‚Äî'} ‚Ä¢ ${drug.form || '‚Äî'}, ${drug.dosage || ''}</small><br>
            <small>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ${drug.producer || '‚Äî'}</small><br>
            <small>
              <strong>–†–µ–≥. ‚Ññ:</strong> ${drug.reg_number || '‚Äî'}<br>
              <a href="https://grls.rosminzdrav.ru/#!/GrlsList" target="_blank" class="grls-link">
                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ì–†–õ–°
              </a>
            </small>
          </div>
        </label>
      </div>`
    ).join('');

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
    selectedDrugs = [];
    document.getElementById('compareBtn').disabled = true;
  }

  // –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ ‚Äî –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤!
  document.getElementById('results').addEventListener('change', (e) => {
    if (e.target.type === 'checkbox') {
      const drugJson = e.target.getAttribute('data-drug');
      const drug = JSON.parse(drugJson.replace(/&#39;/g, "'"));
      
      if (e.target.checked) {
        selectedDrugs.push(drug);
      } else {
        selectedDrugs = selectedDrugs.filter(d => d.trade_name !== drug.trade_name || d.reg_number !== drug.reg_number);
      }
      
      document.getElementById('compareBtn').disabled = !(selectedDrugs.length >= 2 && selectedDrugs.length <= 3);
    }
  });

  document.getElementById('compareBtn').addEventListener('click', () => {
    if (selectedDrugs.length < 2) return;

    const table = `
      <h3><i class="fas fa-balance-scale"></i> –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–æ–≤</h3>
      <table>
        <thead>
          <tr>
            <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
            ${selectedDrugs.map(d => `<th>${d.trade_name}</th>`).join('')}
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>–ú–ù–ù</strong></td>${selectedDrugs.map(d => `<td>${d.mnn || '‚Äî'}</td>`).join('')}</tr>
          <tr><td><strong>–§–æ—Ä–º–∞</strong></td>${selectedDrugs.map(d => `<td>${d.form || '‚Äî'}</td>`).join('')}</tr>
          <tr><td><strong>–î–æ–∑–∏—Ä–æ–≤–∫–∞</strong></td>${selectedDrugs.map(d => `<td>${d.dosage || '‚Äî'}</td>`).join('')}</tr>
          <tr><td><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</strong></td>${selectedDrugs.map(d => `<td>${d.producer || '‚Äî'}</td>`).join('')}</tr>
          <tr><td><strong>–°—Ç—Ä–∞–Ω–∞</strong></td>${selectedDrugs.map(d => `<td>${d.country || '‚Äî'}</td>`).join('')}</tr>
          <tr>
            <td><strong>–†–µ–≥. ‚Ññ</strong></td>
            ${selectedDrugs.map(d => `
              <td>
                ${d.reg_number || '‚Äî'}<br>
                <a href="https://grls.rosminzdrav.ru/#!/GrlsList" target="_blank" class="grls-link" style="font-size:0.8em;">
                  üîç –ì–†–õ–°
                </a>
              </td>
            `).join('')}
          </tr>
        </tbody>
      </table>
    `;
    document.getElementById('comparison').innerHTML = table;
  });
</script>